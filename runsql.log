
D:\data\prjs\netology\fw1>chcp 65001 
Active code page: 65001

D:\data\prjs\netology\fw1>set pghome=D:\PostgreSQL\pg10 

D:\data\prjs\netology\fw1>set pghost=localhost 

D:\data\prjs\netology\fw1>set pgport=5432 

D:\data\prjs\netology\fw1>set pgpwd=root 

D:\data\prjs\netology\fw1>set PGPASSWORD=root 

D:\data\prjs\netology\fw1>set PGCLIENTENCODING='UTF-8' 

D:\data\prjs\netology\fw1>set ON_ERROR_STOP=on 

D:\data\prjs\netology\fw1>D:\PostgreSQL\pg10\bin\psql -h localhost -p 5432 -U postgres -d postgres -a -f sqls.sql 
SELECT '–§–ò–û: –•–∞–ª–∏—É–ª–ª–∏–Ω –ê–π—Ä–∞—Ç'; 
       ?column?       
----------------------
 –§–ò–û: –•–∞–ª–∏—É–ª–ª–∏–Ω –ê–π—Ä–∞—Ç
(1 ÒÚÓÍ‡)



-- "1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º"

with databyparts as (
select count(1) cnt from netlogfw1.sessions_201511
union all
select count(1) cnt from netlogfw1.sessions_201512
union all
select count(1) cnt from netlogfw1.sessions_201601
union all
select count(1) cnt from netlogfw1.sessions_201602
union all
select count(1) cnt from netlogfw1.sessions_201603
)
select '–ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º' as "–û–ø–∏—Å–∞–Ω–∏–µ", sum(cnt) as "–ó–Ω–∞—á–µ–Ω–∏–µ" from databyparts
union all
select '–ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ' as "–û–ø–∏—Å–∞–Ω–∏–µ", count(1) as "–ó–Ω–∞—á–µ–Ω–∏–µ" from netlogfw1.sessions;
                –û–ø–∏—Å–∞–Ω–∏–µ                | –ó–Ω–∞—á–µ–Ω–∏–µ 
----------------------------------------+----------
 –ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º            |   776619
 –ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ |   776619
(2 ÒÚÓÍË)


--  "2. –í—ã–±–æ—Ä–∫–∞ —Å–ø–∏—Å–æ–∫ –∫–∏–Ω–æ—Å–µ—Ç–µ–π"
SELECT
  t.holding_id as "ID –∫–∏–Ω–æ—Å–µ—Ç–∏",
  h.theatre_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏",
  count(distinct t.theatre_id) as "–ö–æ–ª-–≤–æ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤"
FROM netlogfw1.theatres t
	LEFT JOIN netlogfw1.theatres h ON h.theatre_id = t.holding_id
WHERE t.orgtype = 'p'
GROUP BY t.holding_id, h.theatre_name
;
 ID –∫–∏–Ω–æ—Å–µ—Ç–∏ |     –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏     | –ö–æ–ª-–≤–æ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤ 
-------------+---------------------------+--------------------
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |                 30
        1315 | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               |                 25
        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |                 29
        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |                 74
(4 ÒÚÓÍË)


--  "3. –í—ã–±–æ—Ä–∫–∞ —Å–ø–∏—Å–æ–∫ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤, –ø–µ—Ä–≤—ã–µ 30 –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤"
SELECT
  t.holding_id as "ID –∫–∏–Ω–æ—Å–µ—Ç–∏",
  h.theatre_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏",
  t.region as "–†–µ–≥–∏–æ–Ω",
  t.city as "–ì–æ—Ä–æ–¥",
  t.theatre_id as "ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞",
  t.theatre_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞"
FROM netlogfw1.theatres t
	LEFT JOIN netlogfw1.theatres h ON h.theatre_id = t.holding_id
WHERE t.orgtype = 'p'
ORDER BY "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏", "–†–µ–≥–∏–æ–Ω", "–ì–æ—Ä–æ–¥", "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞"
LIMIT 30
;
 ID –∫–∏–Ω–æ—Å–µ—Ç–∏ |     –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏     |       –†–µ–≥–∏–æ–Ω       |      –ì–æ—Ä–æ–¥       | ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ |        –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞        
-------------+---------------------------+--------------------+------------------+---------------+-----------------------------------
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª   | –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å –≥      |          2271 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω –†–µ—Å–ø  | –£—Ñ–∞ –≥            |          5448 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –£—Ñ–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª   | –í–ª–∞–¥–∏–º–∏—Ä –≥       |           215 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –í–ª–∞–¥–∏–º–∏—Ä
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª  | –í–æ–ª–≥–æ–≥—Ä–∞–¥ –≥      |           212 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –í–æ–ª–≥–æ–≥—Ä–∞–¥
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª  | –í–æ–ª–∂—Å–∫–∏–π –≥       |          2544 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –í–æ–ª–∂—Å–∫–∏–π
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª      | –ò—Ä–∫—É—Ç—Å–∫ –≥        |          7078 | –ö–∏–Ω–æ–º–∞–∫—Å-–ò—Ä–∫—É—Ç—Å–∫
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª      | –ö–∏—Ä–æ–≤ –≥          |          2151 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ö–∏—Ä–æ–≤
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π | –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä –≥      |           210 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π  | –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ –≥     |          1232 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |           213 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-XL¬ª –≥. –ú–æ—Å–∫–≤–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |          5736 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–í–æ–¥–Ω—ã–π¬ª –≥. –ú–æ—Å–∫–≤–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |          6100 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–ú–æ–∑–∞–∏–∫–∞¬ª –≥. –ú–æ—Å–∫–≤–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |          6101 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–ü—Ä–∞–∂—Å–∫–∞—è¬ª –≥. –ú–æ—Å–∫–≤–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |           208 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–°–æ–ª—è—Ä–∏—Å¬ª –≥. –ú–æ—Å–∫–≤–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |          7559 | –ö–∏–Ω–æ–º–∞–∫—Å-–ñ—É–ª–µ–±–∏–Ω–æ
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ú–æ—Å–∫–≤–∞ –≥           | –ú–æ—Å–∫–≤–∞ –≥         |          7667 | –ö–∏–Ω–æ–º–∞–∫—Å-–¢–∏—Ç–∞–Ω
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π      | –ü–µ—Ä–º—å –≥          |           221 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ü–µ—Ä–º—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª     | –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É –≥ |           207 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª     | –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É –≥ |          7803 | –≥. –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É ¬´–ö–∏–Ω–æ–º–∞–∫—Å-IMAX¬ª
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª      | –†—è–∑–∞–Ω—å –≥         |          2330 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –†—è–∑–∞–Ω—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª      | –°–∞–º–∞—Ä–∞ –≥         |          5626 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –°–∞–º–∞—Ä–∞
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª   | –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –≥   |           219 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø     | –ö–∞–∑–∞–Ω—å –≥         |           211 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–¢–∞–Ω–¥–µ–º¬ª –≥. –ö–∞–∑–∞–Ω—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø     | –ö–∞–∑–∞–Ω—å –≥         |          2155 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–Æ–∂–Ω—ã–π¬ª –≥. –ö–∞–∑–∞–Ω—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª      | –¢—é–º–µ–Ω—å –≥         |          5482 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –¢—é–º–µ–Ω—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø    | –ò–∂–µ–≤—Å–∫ –≥         |          2152 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ò–∂–µ–≤—Å–∫
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª    | –ß–µ–ª—è–±–∏–Ω—Å–∫ –≥      |          2272 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–†–æ–¥–Ω–∏–∫¬ª –≥. –ß–µ–ª—è–±–∏–Ω—Å–∫
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª    | –ß–µ–ª—è–±–∏–Ω—Å–∫ –≥      |           218 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–£—Ä–∞–ª¬ª –≥. –ß–µ–ª—è–±–∏–Ω—Å–∫
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª    | –Ø—Ä–æ—Å–ª–∞–≤–ª—å –≥      |          2153 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–ê–ª—å—Ç–∞–∏—Ä¬ª –≥. –Ø—Ä–æ—Å–ª–∞–≤–ª—å
          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | –Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª    | –Ø—Ä–æ—Å–ª–∞–≤–ª—å –≥      |          5548 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–ê—É—Ä–∞¬ª –≥. –Ø—Ä–æ—Å–ª–∞–≤–ª—å
(30 ÒÚÓÍ)


-- "4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º"
SELECT t.region as "–†–µ–≥–∏–æ–Ω", 
	count(distinct h.theatre_id) as "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤",
	count(distinct h.hall_id) as "–ö–∏–Ω–æ–∑–∞–ª–æ–≤",
	count(distinct h.hall_id)/count(distinct h.theatre_id) as "–°—Ä–µ–¥. –∫–∏–Ω–æ–∑–∞–ª–æ–≤ –Ω–∞ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä",
	trunc(avg(h.places)) as "–°—Ä–µ–¥. –º–µ—Å—Ç –Ω–∞ –∫–∏–Ω–æ–∑–∞–ª",
	sum(case h.exp_3d when '1' then 1 else 0 end) as "–ö–æ–ª-–≤–æ 3D –∫–∏–Ω–æ–∑–∞–ª–æ–≤",
	sum(case h.exp_imax when '1' then 1 else 0 end) as "–ö–æ–ª-–≤–æ IMAX –∫–∏–Ω–æ–∑–∞–ª–æ–≤",
	sum(case h.exp_laser when '1' then 1 else 0 end) as "–ö–æ–ª-–≤–æ LASER –∫–∏–Ω–æ–∑–∞–ª–æ–≤",
	sum(case h.exp_dvd when '1' then 1 else 0 end) as "–ö–æ–ª-–≤–æ DVD –∫–∏–Ω–æ–∑–∞–ª–æ–≤"
  FROM netlogfw1.halls h
	INNER JOIN netlogfw1.theatres t ON t.theatre_id = h.theatre_id AND t.orgtype = 'p'
GROUP BY t.region
ORDER BY 2 DESC
;
                   –†–µ–≥–∏–æ–Ω                    | –ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤ | –ö–∏–Ω–æ–∑–∞–ª–æ–≤ | –°—Ä–µ–¥. –∫–∏–Ω–æ–∑–∞–ª–æ–≤ –Ω–∞ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä | –°—Ä–µ–¥. –º–µ—Å—Ç –Ω–∞ –∫–∏–Ω–æ–∑–∞–ª | –ö–æ–ª-–≤–æ 3D –∫–∏–Ω–æ–∑–∞–ª–æ–≤ | –ö–æ–ª-–≤–æ IMAX –∫–∏–Ω–æ–∑–∞–ª–æ–≤ | –ö–æ–ª-–≤–æ LASER –∫–∏–Ω–æ–∑–∞–ª–æ–≤ | –ö–æ–ª-–≤–æ DVD –∫–∏–Ω–æ–∑–∞–ª–æ–≤ 
---------------------------------------------+-------------+-----------+------------------------------+-----------------------+---------------------+-----------------------+------------------------+----------------------
 –ú–æ—Å–∫–≤–∞ –≥                                    |          49 |       396 |                            8 |                   158 |                 309 |                     8 |                      0 |                    0
 –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –≥                           |          24 |       198 |                            8 |                   162 |                 143 |                     5 |                      0 |                    0
 –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª                              |          10 |        96 |                            9 |                   186 |                  68 |                     3 |                      0 |                    0
 –Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª                             |           4 |        21 |                            5 |                   160 |                  21 |                     0 |                      0 |                    0
 –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π                               |           4 |        29 |                            7 |                   180 |                  21 |                     1 |                      0 |                    0
 –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø                              |           4 |        30 |                            7 |                   154 |                  30 |                     1 |                      0 |                    0
 –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª                           |           4 |        40 |                           10 |                   160 |                  21 |                     1 |                      0 |                    0
 –ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª                             |           3 |        23 |                            7 |                   184 |                  14 |                     1 |                      0 |                    0
 –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª                            |           3 |        28 |                            9 |                   132 |                  19 |                     1 |                      0 |                    0
 –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª                              |           3 |        24 |                            8 |                   132 |                  17 |                     1 |                      0 |                    0
 –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª                           |           3 |        19 |                            6 |                   173 |                  19 |                     1 |                      0 |                    0
 –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω –†–µ—Å–ø                           |           3 |        25 |                            8 |                   201 |                  25 |                     0 |                      0 |                    0
 –¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª                               |           2 |        18 |                            9 |                   207 |                  18 |                     1 |                      0 |                    0
 –ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª                            |           2 |        11 |                            5 |                   133 |                  11 |                     0 |                      0 |                    0
 –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª                            |           2 |         8 |                            4 |                   130 |                   6 |                     0 |                      0 |                    0
 –í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª                             |           2 |        10 |                            5 |                   150 |                   3 |                     0 |                      0 |                    0
 –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª                         |           2 |        16 |                            8 |                   149 |                  16 |                     1 |                      0 |                    0
 –ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª                               |           2 |         6 |                            3 |                   134 |                   4 |                     0 |                      0 |                    0
 –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π                          |           2 |        18 |                            9 |                   205 |                  12 |                     0 |                      0 |                    0
 –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π                           |           2 |        18 |                            9 |                   225 |                  18 |                     1 |                      0 |                    0
 –ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª                           |           2 |        18 |                            9 |                   184 |                  18 |                     1 |                      0 |                    0
 –†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª                               |           2 |        16 |                            8 |                   172 |                  12 |                     1 |                      0 |                    0
 –°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª                               |           2 |        17 |                            8 |                   144 |                  11 |                     1 |                      0 |                    0
 –°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª                             |           2 |        17 |                            8 |                   166 |                  17 |                     1 |                      0 |                    0
 –¢—É–ª—å—Å–∫–∞—è –æ–±–ª                                |           2 |        10 |                            5 |                   137 |                   5 |                     1 |                      0 |                    0
 –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø                             |           2 |        14 |                            7 |                   144 |                  14 |                     0 |                      0 |                    0
 –•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥ - –Æ–≥—Ä–∞ –ê–û |           2 |        16 |                            8 |                   157 |                  16 |                     1 |                      0 |                    0
 –ö–æ–º–∏ –†–µ—Å–ø                                   |           1 |         7 |                            7 |                   194 |                   6 |                     1 |                      0 |                    0
 –£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª                             |           1 |         9 |                            9 |                   163 |                   9 |                     1 |                      0 |                    0
 –ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª                               |           1 |         9 |                            9 |                   160 |                   9 |                     0 |                      0 |                    0
 –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π                         |           1 |         8 |                            8 |                   179 |                   8 |                     1 |                      0 |                    0
 –¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª                              |           1 |         4 |                            4 |                   125 |                   4 |                     0 |                      0 |                    0
 –ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª                             |           1 |         8 |                            8 |                   190 |                   7 |                     1 |                      0 |                    0
 –¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª                                |           1 |         5 |                            5 |                   134 |                   5 |                     0 |                      0 |                    0
 –í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª                             |           1 |        10 |                           10 |                   202 |                  10 |                     1 |                      0 |                    0
 –ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª                              |           1 |         4 |                            4 |                   132 |                   2 |                     0 |                      0 |                    0
 –û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª                               |           1 |         4 |                            4 |                   184 |                   4 |                     0 |                      0 |                    0
 –ú–æ—Ä–¥–æ–≤–∏—è –†–µ—Å–ø                               |           1 |         4 |                            4 |                   126 |                   4 |                     0 |                      0 |                    0
 –ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª                             |           1 |         4 |                            4 |                    99 |                   4 |                     0 |                      0 |                    0
 –ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª                            |           1 |         9 |                            9 |                   142 |                   9 |                     2 |                      0 |                    0
 –ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª                               |           1 |        13 |                           13 |                   165 |                   5 |                     0 |                      0 |                    0
(41 ÒÚÓÍ‡)


-- "5. –í—ã–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30 —Å–µ–∞–Ω—Å–æ–≤ 2015 –≥–æ–¥–∞"
WITH vtheatres AS (
	SELECT
	  t.holding_id,
	  h.theatre_name as holding_name,
	  t.theatre_id,
	  t.theatre_name,
	  t.region,
	  t.city
	FROM netlogfw1.theatres t
		LEFT JOIN netlogfw1.theatres h ON h.theatre_id = t.holding_id
	WHERE t.orgtype = 'p'
)
SELECT 
  s.sess_id as "ID —Å–µ–∞–Ω—Å–∞",  
  s.show_date as "–î–∞—Ç–∞/–≤—Ä–µ–º—è —Å–µ–∞–Ω—Å–∞",  
  t.region as "–†–µ–≥–∏–æ–Ω",  
  t.city as "–ì–æ—Ä–æ–¥",  
  t.holding_id as "ID –∫–∏–Ω–æ—Å–µ—Ç–∏",  
  t.holding_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏",  
  t.theatre_id as "ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞",  
  t.theatre_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞",  
  s.hall_id as "ID –∫–∏–Ω–æ–∑–∞–ª–∞",  
  h.hall_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ–∑–∞–ª–∞",  
  h.places as "–ö–æ–ª-–≤–æ –º–µ—Å—Ç –≤ –∫–∏–Ω–æ–∑–∞–ª–µ",
  s.film_id as "ID —Ñ–∏–ª—å–º–∞",  
  s.tckts as "–ö–æ–ª-–≤–æ –∑—Ä–∏—Ç–µ–ª–µ–π",
  case when h.places > 0 then round(s.tckts/h.places * 100, 1) else 0 end as "–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –∑–∞–ª–∞, %",
  s.summ as "–°–±–æ—Ä—ã, —Ä—É–±"
  FROM netlogfw1.sessions s
  INNER JOIN vtheatres t ON t.theatre_id = s.theatre_id
  INNER JOIN netlogfw1.halls h ON h.hall_id = s.hall_id
  WHERE s.show_date BETWEEN to_timestamp('2015-12-31T00:00:00', 'YYYY-MM-DD"T"HH24:MI:SS') AND to_timestamp('2015-12-31T23:59:59', 'YYYY-MM-DD"T"HH24:MI:SS')
 ORDER BY show_date DESC
 LIMIT 30
;
 ID —Å–µ–∞–Ω—Å–∞ |  –î–∞—Ç–∞/–≤—Ä–µ–º—è —Å–µ–∞–Ω—Å–∞  |      –†–µ–≥–∏–æ–Ω       |    –ì–æ—Ä–æ–¥    | ID –∫–∏–Ω–æ—Å–µ—Ç–∏ |     –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Å–µ—Ç–∏     | ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ |     –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞      | ID –∫–∏–Ω–æ–∑–∞–ª–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ–∑–∞–ª–∞ | –ö–æ–ª-–≤–æ –º–µ—Å—Ç –≤ –∫–∏–Ω–æ–∑–∞–ª–µ | ID —Ñ–∏–ª—å–º–∞ | –ö–æ–ª-–≤–æ –∑—Ä–∏—Ç–µ–ª–µ–π | –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –∑–∞–ª–∞, % | –°–±–æ—Ä—ã, —Ä—É–± 
-----------+---------------------+-------------------+-------------+-------------+---------------------------+---------------+------------------------------+-------------+-------------------+------------------------+-----------+-----------------+-----------------------+------------
  24002119 | 2015-12-31 19:30:00 | –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø   | –ò–∂–µ–≤—Å–∫ –≥    |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1817 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π |        6121 | 05                |                     50 | 111017815 |              26 |                  52.0 |       6342
  23985711 | 2015-12-31 19:30:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1819 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π    |        2765 | 05                |                    288 | 111017815 |              52 |                  18.1 |      10853
  24014733 | 2015-12-31 19:25:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1820 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –ö—Ä–∏—Å—Ç–∞–ª–ª         |        2774 | 04                |                    175 | 121024615 |               7 |                   4.0 |       1569
  24021511 | 2015-12-31 19:20:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1820 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –ö—Ä–∏—Å—Ç–∞–ª–ª         |        6722 | 08                |                     27 | 121024915 |               1 |                   3.7 |        642
  24012304 | 2015-12-31 19:10:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1820 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –ö—Ä–∏—Å—Ç–∞–ª–ª         |        2771 | 01                |                    213 | 111017815 |              25 |                  11.7 |       4927
  23982403 | 2015-12-31 19:00:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1819 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π    |        2764 | 04                |                    288 | 121024915 |              17 |                   5.9 |       3339
  23999326 | 2015-12-31 19:00:00 | –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø   | –ò–∂–µ–≤—Å–∫ –≥    |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1817 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π |        2749 | 01                |                    206 | 111017815 |              18 |                   8.7 |       5504
  24020856 | 2015-12-31 18:50:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1819 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π    |        3255 | 08                |                    162 | 124004115 |              21 |                  13.0 |       5009
  24020009 | 2015-12-31 18:50:00 | –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø   | –ò–∂–µ–≤—Å–∫ –≥    |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1817 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π |        6122 | 06                |                     54 | 111019915 |              23 |                  42.6 |       4268
  24021683 | 2015-12-31 18:40:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |          5736 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–í–æ–¥–Ω—ã–π¬ª –≥. –ú–æ—Å–∫–≤–∞  |        6471 | –ó–∞–ª 1             |                    295 | 111017115 |               5 |                   1.7 |       2080
  23997476 | 2015-12-31 18:40:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1820 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –ö—Ä–∏—Å—Ç–∞–ª–ª         |        2775 | 05                |                    258 | 121024915 |              32 |                  12.4 |      17797
  23982405 | 2015-12-31 18:35:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1819 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π    |        2766 | 06                |                    126 | 111019915 |              23 |                  18.3 |       5990
  24020977 | 2015-12-31 18:35:00 | –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø   | –ò–∂–µ–≤—Å–∫ –≥    |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1817 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π |        2751 | 03                |                    125 | 121024915 |               6 |                   4.8 |       2030
  24019796 | 2015-12-31 18:30:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1820 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –ö—Ä–∏—Å—Ç–∞–ª–ª         |        6721 | 07                |                     21 | 121024615 |               1 |                   4.8 |        640
  24020828 | 2015-12-31 18:30:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫"   |        6711 | –ó–∞–ª 15            |                    223 | 124004315 |               6 |                   2.7 |       1791
  24018277 | 2015-12-31 18:20:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1819 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π    |        2762 | 02                |                    288 | 121024615 |              15 |                   5.2 |       4225
  24020978 | 2015-12-31 18:10:00 | –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø   | –ò–∂–µ–≤—Å–∫ –≥    |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1817 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π |        2752 | 04                |                    227 | 121024615 |               4 |                   1.8 |        853
  24021588 | 2015-12-31 18:10:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫"   |        6710 | –ó–∞–ª 14            |                    203 | 121024615 |              11 |                   5.4 |       5518
  23966661 | 2015-12-31 18:10:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |          5736 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–í–æ–¥–Ω—ã–π¬ª –≥. –ú–æ—Å–∫–≤–∞  |        6472 | –ó–∞–ª 2             |                    262 | 111017815 |              14 |                   5.3 |       6634
  24018285 | 2015-12-31 18:05:00 | –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π     | –ü–µ—Ä–º—å –≥     |        1670 | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               |          1819 | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π    |        3256 | 09                |                    152 | 111017815 |               4 |                   2.6 |        931
  24021499 | 2015-12-31 18:05:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°         |        6279 | –ó–∞–ª 13            |                    165 | 111017815 |              14 |                   8.5 |       5976
  24015814 | 2015-12-31 18:00:00 | –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª | –í–æ–ª–∂—Å–∫–∏–π –≥  |          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |          2544 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –í–æ–ª–∂—Å–∫–∏–π       |        4393 | –ó–∞–ª 6             |                    130 | 111017115 |               5 |                   3.8 |        823
  24018739 | 2015-12-31 18:00:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |           213 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-XL¬ª –≥. –ú–æ—Å–∫–≤–∞      |         349 | XL                |                    117 | 111017115 |              14 |                  12.0 |       6888
  23997407 | 2015-12-31 18:00:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫"   |        6708 | –ó–∞–ª 12            |                    223 | 111017815 |              24 |                  10.8 |      11105
  24021496 | 2015-12-31 18:00:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°         |        6281 | –ó–∞–ª 15            |                    203 | 124004315 |               4 |                   2.0 |       1921
  24021857 | 2015-12-31 18:00:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°         |        6286 | –ó–∞–ª 20            |                     50 | 121024615 |               2 |                   4.0 |       1629
  24018551 | 2015-12-31 18:00:00 | –ú–æ—Å–∫–≤–∞ –≥          | –ú–æ—Å–∫–≤–∞ –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫"   |        6713 | –ó–∞–ª 17            |                    135 | 111017115 |              11 |                   8.1 |       3226
  24021635 | 2015-12-31 18:00:00 | –ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª  | –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å –≥ |          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |          2271 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å      |        3648 | –ó–∞–ª 5             |                     90 | 111017115 |               6 |                   6.7 |       2365
  24003850 | 2015-12-31 18:00:00 | –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø    | –ö–∞–∑–∞–Ω—å –≥    |        1577 | –ö–ê–†–û –§–ò–õ–¨–ú                |          1591 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ –ö–æ–ª—å—Ü–æ       |        2035 | –ó–ê–õ ‚Ññ5            |                    138 | 111017115 |               9 |                   6.5 |       3085
  24013783 | 2015-12-31 18:00:00 | –¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª     | –¢—é–º–µ–Ω—å –≥    |          70 | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ |          5482 | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –¢—é–º–µ–Ω—å         |        5903 | –ó–∞–ª 2             |                    131 | 121024915 |              11 |                   8.4 |       4810
(30 ÒÚÓÍ)


-- "6. –¢–æ–ø 10 —Ñ–∏–ª—å–º–æ–≤ –ø–æ —Å–±–æ—Ä–∞–º –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥"
WITH sumdata AS (
	SELECT 
	  s.film_id,  
	  sum(s.summ) as summ
	  FROM netlogfw1.sessions s
	 GROUP BY s.film_id
)
SELECT a.film_id as "–ù–æ–º–µ—Ä –ü–£", 
	a.film_name as "–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞", 
	a.prod_year as "–ì–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è", 
	a.mdirector as "–†–µ–∂–∏—Å–µ—Ä", 
	to_char(a.startdate, 'DD.MM.YYYY') as "–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ –≤ –ø—Ä–æ–∫–∞—Ç",
	to_char(s.summ, 'FM999G999G990D0') as "–°—É–º–º–∞ —Å–±–æ—Ä–æ–≤, —Ä—É–±"
  FROM netlogfw1.films a
  INNER JOIN sumdata s ON s.film_id = a.film_id
  ORDER BY summ DESC
   LIMIT 10
;
 –ù–æ–º–µ—Ä –ü–£  |                 –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞                 | –ì–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è |              –†–µ–∂–∏—Å–µ—Ä               | –î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ –≤ –ø—Ä–æ–∫–∞—Ç | –°—É–º–º–∞ —Å–±–æ—Ä–æ–≤, —Ä—É–± 
-----------+-------------------------------------------------+--------------+------------------------------------+----------------------+-------------------
 121024915 | –ó–≤—ë–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã: –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ —Å–∏–ª—ã                | 2015         | –î–∂–µ–π –î–∂–µ–π –ê–±—Ä–∞–º—Å                   | 17.12.2015           | 504¬†199¬†733,0
 124000316 | –ó–≤–µ—Ä–æ–ø–æ–ª–∏—Å                                      | 2016         | –†–∏—á –ú—É—Ä, –ë–∞–π—Ä–æ–Ω –•–æ–≤–∞—Ä–¥             | 03.03.2016           | 490¬†621¬†660,0
 121002116 | –î—ç–¥–ø—É–ª                                          | 2016         | –¢–∏–º –ú–∏–ª–ª–µ—Ä                         | 11.02.2016           | 410¬†307¬†417,0
 121026215 | –í—ã–∂–∏–≤—à–∏–π (2015)                                 | 2015         | –ê–ª–µ—Ö–∞–Ω–¥—Ä–æ –ì–æ–Ω—Å–∞–ª–µ—Å –ò–Ω—å—è—Ä—Ä–∏—Ç—É       | 07.01.2016           | 301¬†092¬†132,0
 121021715 | 007: –°–ø–µ–∫—Ç—Ä                                     | 2015         | –°—ç–º –ú–µ–Ω–¥–µ—Å                         | 06.11.2015           | 244¬†767¬†629,0
 124000116 | –ö—É–Ω–≥-—Ñ—É –ü–∞–Ω–¥–∞ 3                                 | 2016         | –ê–ª–µ—Å—Å–∞–Ω–¥—Ä–æ –ö–∞—Ä–ª–æ–Ω–∏, –î–∂–µ–Ω–Ω–∏—Ñ–µ—Ä –Æ    | 28.01.2016           | 190¬†859¬†157,0
 121022415 | –ì–æ–ª–æ–¥–Ω—ã–µ –∏–≥—Ä—ã: –°–æ–π–∫–∞-–ø–µ—Ä–µ—Å–º–µ—à–Ω–∏—Ü–∞. –ß–∞—Å—Ç—å 2      | 2015         | –§—Ä–µ–Ω—Å–∏—Å –õ–æ—É—Ä–µ–Ω—Å                    | 19.11.2015           | 173¬†034¬†748,0
 121003616 | –ë–æ–≥–∏ –ï–≥–∏–ø—Ç–∞                                     | 2016         | –ê–ª–µ–∫—Å –ü—Ä–æ–π–∞—Å                       | 25.02.2016           | 170¬†452¬†377,0
 121004816 | –ë—ç—Ç–º–µ–Ω –ø—Ä–æ—Ç–∏–≤ –°—É–ø–µ—Ä–º–µ–Ω–∞: –ù–∞ –∑–∞—Ä–µ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ | 2016         | –ó–∞–∫ –°–Ω–∞–π–¥–µ—Ä                        | 24.03.2016           | 165¬†310¬†696,0
 111017815 | –°–∞–º—ã–π –õ—É—á—à–∏–π –î–µ–Ω—å                               | 2015         | –ê.–ü–µ—Ä—à–∏–Ω (–ø—Å–µ–≤–¥–æ–Ω–∏–º –ñ.–ö—Ä—ã–∂–æ–≤–Ω–∏–∫–æ–≤) | 24.12.2015           | 163¬†693¬†660,0
(10 ÒÚÓÍ)


-- "7. –ö–∞–∫ —Ñ–∏–ª—å–º 121024915 - "–ó–≤—ë–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã: –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ —Å–∏–ª—ã", –Ω–∞–±–∏—Ä–∞–ª –∑—Ä–∏—Ç–µ–ª–µ–π –≤ —Ç–µ—á–µ–Ω–∏–∏ –ø–µ—Ä–≤—ã—Ö 30 –¥–Ω–µ–π –ø—Ä–æ–∫–∞—Ç–∞"
WITH filmstat AS (
	SELECT 
	  s.film_id,  
	  date_trunc('day', s.show_date)::date as show_date,
	  sum(s.tckts) as tckts
	  FROM netlogfw1.sessions s
	 GROUP BY s.film_id, date_trunc('day', s.show_date)::date
)
SELECT
	a.show_date as "–î–∞—Ç–∞ –ø–æ–∫–∞–∑–∞",
	case EXTRACT(DOW FROM a.show_date) 
		when 0 then '–í–°' when 1 then '–ü–ù' when 2 then '–í–¢' when 3 then '–°–†' 
		when 4 then '–ß–¢' when 5 then '–ü–¢' when 6 then '–°–ë' 
	end as dayw,
	a.tckts as "–ó—Ä–∏—Ç–µ–ª–µ–π",
	round(case when coalesce(lag(a.tckts, 1) over (order by a.show_date), 0) = 0 
			then 100 else (a.tckts/coalesce(lag(a.tckts, 1) over (order by a.show_date), 0) - 1) * 100 end, 1) as "–ü—Ä–∏—Ä–æ—Å—Ç –∑—Ä–∏—Ç–µ–ª–µ–π, %" -- –ü—Ä–∏—Ä–æ—Å—Ç –∑—Ä–∏—Ç–µ–ª–µ–π –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –¥–Ω—é
FROM filmstat a
WHERE a.film_id = '121024915'
ORDER BY a.show_date
LIMIT 30
;
 –î–∞—Ç–∞ –ø–æ–∫–∞–∑–∞ | dayw | –ó—Ä–∏—Ç–µ–ª–µ–π | –ü—Ä–∏—Ä–æ—Å—Ç –∑—Ä–∏—Ç–µ–ª–µ–π, % 
-------------+------+----------+---------------------
 2015-12-16  | –°–†   |      167 |               100.0
 2015-12-17  | –ß–¢   |   118691 |             70972.5
 2015-12-18  | –ü–¢   |    82474 |               -30.5
 2015-12-19  | –°–ë   |   164367 |                99.3
 2015-12-20  | –í–°   |   150583 |                -8.4
 2015-12-21  | –ü–ù   |    37117 |               -75.4
 2015-12-22  | –í–¢   |    30955 |               -16.6
 2015-12-23  | –°–†   |    29392 |                -5.0
 2015-12-24  | –ß–¢   |    20877 |               -29.0
 2015-12-25  | –ü–¢   |    24690 |                18.3
 2015-12-26  | –°–ë   |    54651 |               121.3
 2015-12-27  | –í–°   |    55411 |                 1.4
 2015-12-28  | –ü–ù   |    25402 |               -54.2
 2015-12-29  | –í–¢   |    24393 |                -4.0
 2015-12-30  | –°–†   |    24742 |                 1.4
 2015-12-31  | –ß–¢   |     9415 |               -61.9
 2016-01-01  | –ü–¢   |    29389 |               212.2
 2016-01-02  | –°–ë   |    46164 |                57.1
 2016-01-03  | –í–°   |    40243 |               -12.8
 2016-01-04  | –ü–ù   |    34201 |               -15.0
 2016-01-05  | –í–¢   |    29569 |               -13.5
 2016-01-06  | –°–†   |    24350 |               -17.7
 2016-01-07  | –ß–¢   |    17322 |               -28.9
 2016-01-08  | –ü–¢   |    16508 |                -4.7
 2016-01-09  | –°–ë   |    14772 |               -10.5
 2016-01-10  | –í–°   |    13071 |               -11.5
 2016-01-11  | –ü–ù   |     4322 |               -66.9
 2016-01-12  | –í–¢   |     4016 |                -7.1
 2016-01-13  | –°–†   |     4227 |                 5.3
 2016-01-14  | –ß–¢   |     1838 |               -56.5
(30 ÒÚÓÍ)



-- "8. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∫–∞—Ç–∞ –ø–æ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞–º, —Ç–æ–ø 10 —Å–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–æ–≤ —Å–æ —Å—Ö–æ–∂–∏–º —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä–æ–º –≤ –ø–µ—Ä–∏–æ–¥ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –ø—Ä–∞–∑–¥–∏–Ω–∫–æ–≤ —Å 2015-12-30 –ø–æ 2016-01-11"
WITH theatres AS (
	SELECT a.theatre_id, a.theatre_name
	FROM netlogfw1.theatres a
	WHERE a.orgtype = 'p'
)
,hldpairs AS (
	SELECT a.theatre_id as theatre1_id, a.theatre_name as theatre1_name, b.theatre_id as theatre2_id, b.theatre_name as theatre2_name,
	(SELECT string_agg(to_char(aa.itm, 'FM9999999'), '-') FROM (SELECT unnest(ARRAY[a.theatre_id, b.theatre_id]) as itm ORDER BY 1) aa) as pairkey -- –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã—Ö —Å–µ—Ç–µ–π
	FROM theatres a
		CROSS JOIN theatres b 
	WHERE a.theatre_id != b.theatre_id
)
,hldpairsuq AS ( -- –∏—Å–∫–ª—é—á–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø–∞—Ä—ã
SELECT theatre1_id, theatre1_name, theatre2_id, theatre2_name FROM (
	SELECT a.*,
		row_number() over (partition by pairkey) pnum
	  FROM hldpairs a
	) aa WHERE pnum = 1
)
,theatrefilms AS (
	SELECT 
	  s.theatre_id, array_agg(distinct s.film_id) afilms
	  FROM netlogfw1.sessions s
	 WHERE s.show_date BETWEEN to_timestamp('2015-12-30T00:00:00', 'YYYY-MM-DD"T"HH24:MI:SS') AND to_timestamp('2016-01-11T23:59:59', 'YYYY-MM-DD"T"HH24:MI:SS')
	 GROUP BY s.theatre_id
)
,tfintersects AS (
	SELECT 
		theatre1_id, 
		theatre1_name, 
		theatre2_id, 
		theatre2_name,
		(select array_agg(arrItem) as intersectItems from 
		   (
			select UNNEST(f1.afilms) as arrItem
			intersect 
			select UNNEST(f2.afilms) as arrItem
		   ) cmn) as intersects
	  FROM hldpairsuq a
		INNER JOIN theatrefilms f1 ON f1.theatre_id = a.theatre1_id
		INNER JOIN theatrefilms f2 ON f2.theatre_id = a.theatre2_id
)
SELECT 
	a.theatre1_id as "ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 1", 
	a.theatre1_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 1", 
	a.theatre2_id as "ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 2", 
	a.theatre2_name as "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 3",
	array_length(a.intersects, 1) as "–ö–æ–ª-–≤–æ —Å–æ–±–ø–∞–¥–∞—é—â–∏—Ö —Ñ–∏–ª—å–º–æ–≤"
FROM tfintersects a
ORDER BY "–ö–æ–ª-–≤–æ —Å–æ–±–ø–∞–¥–∞—é—â–∏—Ö —Ñ–∏–ª—å–º–æ–≤" DESC
LIMIT 10
;
 ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 1 |    –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 1    | ID –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 2 |   –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ 3    | –ö–æ–ª-–≤–æ —Å–æ–±–ø–∞–¥–∞—é—â–∏—Ö —Ñ–∏–ª—å–º–æ–≤ 
-----------------+-----------------------------+-----------------+----------------------------+----------------------------
            5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°        |            5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫" |                         31
            1928 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –ú–∞–π–∞–º–∏ –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å  |            5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫" |                         25
            1925 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –î–µ –õ—é–∫—Å –ë–µ–ª–∞—è –î–∞—á–∞ |            1928 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –ú–∞–π–∞–º–∏ –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å |                         25
            1925 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –î–µ –õ—é–∫—Å –ë–µ–ª–∞—è –î–∞—á–∞ |            1927 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –°–∏—Ç–∏ "–†–∞–¥—É–≥–∞"     |                         25
            1925 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –î–µ –õ—é–∫—Å –ë–µ–ª–∞—è –î–∞—á–∞ |            5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫" |                         25
            1927 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –°–∏—Ç–∏ "–†–∞–¥—É–≥–∞"      |            5896 | –ö–ê–†–û –§–ò–õ–¨–ú –≤ –¢–¶ "–ê–≤–∏–∞–ø–∞—Ä–∫" |                         25
            1927 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –°–∏—Ç–∏ "–†–∞–¥—É–≥–∞"      |            5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°       |                         25
            1925 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –î–µ –õ—é–∫—Å –ë–µ–ª–∞—è –î–∞—á–∞ |            5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°       |                         25
            1928 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –ú–∞–π–∞–º–∏ –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å  |            5614 | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°       |                         25
            1928 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –ú–∞–π–∞–º–∏ –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å  |            1927 | –ö–∏–Ω–æ—Å—Ç–∞—Ä –°–∏—Ç–∏ "–†–∞–¥—É–≥–∞"     |                         25
(10 ÒÚÓÍ)



-- "9. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∂–∞–Ω—Ä–æ–≤ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –≤ –ø–µ—Ä–∏–æ–¥ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ 2016 –≥–æ–¥–∞"
WITH vfilms AS (
	select a.film_id,
		trim(unnest(string_to_array(a.genre, ','))) as genre
	from netlogfw1.films a
)
SELECT 
  f.genre as "–ñ–∞–Ω—Ä", 
  sum(s.tckts) as "–ö–æ–ª-–≤–æ –∑—Ä–∏—Ç–µ–ª–µ–π"
  FROM netlogfw1.sessions s
	INNER JOIN vfilms f ON f.film_id = s.film_id
 WHERE s.show_date BETWEEN to_timestamp('2015-12-30T00:00:00', 'YYYY-MM-DD"T"HH24:MI:SS') AND to_timestamp('2016-01-11T23:59:59', 'YYYY-MM-DD"T"HH24:MI:SS')
 GROUP BY f.genre
ORDER BY 2 DESC;
      –ñ–∞–Ω—Ä      | –ö–æ–ª-–≤–æ –∑—Ä–∏—Ç–µ–ª–µ–π 
----------------+-----------------
 –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è    |         1398871
 –∫–æ–º–µ–¥–∏—è        |          851637
 —Ç—Ä–∏–ª–ª–µ—Ä        |          701964
 —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞     |          697195
 –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–π   |          694619
 –¥—Ä–∞–º–∞          |          675282
 –±–æ–µ–≤–∏–∫         |          625651
 –≤–µ—Å—Ç–µ—Ä–Ω        |          564684
 —Ñ—ç–Ω—Ç–µ–∑–∏        |          448169
 –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π    |          340542
 –¥–µ—Ç–µ–∫—Ç–∏–≤       |          128403
 –º–µ–ª–æ–¥—Ä–∞–º–∞      |           82756
 —É–∂–∞—Å—ã          |           56542
 –±–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π |           22163
 –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π   |            1871
(15 ÒÚÓÍ)


-- "10. –°–∞–º—ã–µ –ø–æ—Å–µ—â–∞–µ–º—ã–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –≤ –ø–µ—Ä–∏–æ–¥ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ 2016 –≥–æ–¥–∞"
WITH 
theatres AS (
SELECT
  t.holding_id,
  h.theatre_name as holding_name,
  t.theatre_id,
  t.theatre_name,
  t.region,
  t.city
FROM netlogfw1.theatres t
	LEFT JOIN netlogfw1.theatres h ON h.theatre_id = t.holding_id
WHERE t.orgtype = 'p'
)
,theatretckts AS (
	SELECT 
	  t.region,
	  t.city,
	  t.holding_name,
	  s.theatre_id, 
	  t.theatre_name,
	  sum(s.tckts) as tckts,
	  row_number() over (PARTITION BY t.region ORDER BY sum(s.tckts) DESC) npos
	  FROM netlogfw1.sessions s
		INNER JOIN theatres t	ON t.theatre_id = s.theatre_id 
	 WHERE s.show_date BETWEEN to_timestamp('2015-12-30T00:00:00', 'YYYY-MM-DD"T"HH24:MI:SS') AND to_timestamp('2016-01-11T23:59:59', 'YYYY-MM-DD"T"HH24:MI:SS')
	 GROUP BY t.region, t.city, t.holding_name, s.theatre_id, t.theatre_name
)
select 
	a.region as "–†–µ–≥–∏–æ–Ω",
	a.city as "–ì–æ—Ä–æ–¥",
	a.holding_name as "–ö–∏–Ω–æ—Å–µ—Ç—å",
	a.theatre_name as "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä",
	a.tckts as "–í—Å–µ–≥–æ –∑—Ä–∏—Ç–µ–ª–µ–π"
from theatretckts a
where a.npos = 1;
                   –†–µ–≥–∏–æ–Ω                    |       –ì–æ—Ä–æ–¥        |         –ö–∏–Ω–æ—Å–µ—Ç—å          |                –ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä                 | –í—Å–µ–≥–æ –∑—Ä–∏—Ç–µ–ª–µ–π 
---------------------------------------------+--------------------+---------------------------+------------------------------------------+----------------
 –ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª                            | –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å –≥        | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å                  |          30131
 –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω –†–µ—Å–ø                           | –£—Ñ–∞ –≥              | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –£—Ñ–∞                        |          32901
 –ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª                            | –ë–µ–ª–≥–æ—Ä–æ–¥ –≥         | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–ö –°–∏—Ç–∏ –ú–æ–ª–ª –ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∏–π |          25448
 –í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª                            | –í–ª–∞–¥–∏–º–∏—Ä –≥         | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –í–ª–∞–¥–∏–º–∏—Ä                   |          21159
 –í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª                           | –í–æ–ª–∂—Å–∫–∏–π –≥         | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –í–æ–ª–∂—Å–∫–∏–π                   |          20116
 –í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª                             | –í–æ–ª–æ–≥–¥–∞ –≥          | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–ö –ú–∞—Ä–º–µ–ª–∞–¥               |          27422
 –í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª                             | –í–æ—Ä–æ–Ω–µ–∂ –≥          | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –∏ –¢–†–¶ –ì–∞–ª–µ—Ä–µ–∏ –ß–∏–∂–æ–≤–∞         |          43515
 –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª                         | –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥ –≥      | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –ï–≤—Ä–æ–ø–∞                 |          34774
 –ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª                               | –ö–∞–ª—É–≥–∞ –≥           | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –ö–∞–ª—É–≥–∞                       |          14647
 –ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª                               | –ö–∏—Ä–æ–≤ –≥            | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ö–∏—Ä–æ–≤                      |          22690
 –ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª                             | –ö–æ—Å—Ç—Ä–æ–º–∞ –≥         | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –ö–æ—Å—Ç—Ä–æ–º–∞                     |          10934
 –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π                          | –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä –≥        | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä                  |          43481
 –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π                           | –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ –≥       | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫                 |          33595
 –ú–æ—Ä–¥–æ–≤–∏—è –†–µ—Å–ø                               | –°–∞—Ä–∞–Ω—Å–∫ –≥          | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –°–∞—Ä–∞–Ω—Å–∫                      |          14334
 –ú–æ—Å–∫–≤–∞ –≥                                    | –ú–æ—Å–∫–≤–∞ –≥           | –ö–ê–†–û –§–ò–õ–¨–ú                | VEGAS 22 –≤ –¢–†–¶ –í–ï–ì–ê–°                     |          50031
 –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª                              | –ö–æ—Ç–µ–ª—å–Ω–∏–∫–∏ –≥       | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –ö–∏–Ω–æ—Å—Ç–∞—Ä –î–µ –õ—é–∫—Å –ë–µ–ª–∞—è –î–∞—á–∞              |          62336
 –ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª                           | –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥ –≥  | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –°–µ–¥—å–º–æ–µ –Ω–µ–±–æ           |          38065
 –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª                           | –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ –≥      | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –†–æ–π—è–ª –ü–∞—Ä–∫             |          36475
 –û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª                               | –û—Ä–µ–ª –≥             | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –û—Ä–µ–ª                         |           9508
 –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π                               | –ü–µ—Ä–º—å –≥            | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ö–æ–ª–∏–∑–µ–π                |          42815
 –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª                              | –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É –≥   | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É             |          33633
 –†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª                               | –†—è–∑–∞–Ω—å –≥           | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –†—è–∑–∞–Ω—å                     |          28947
 –°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª                               | –°–∞–º–∞—Ä–∞ –≥           | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å¬ª –≥. –°–∞–º–∞—Ä–∞                     |          19582
 –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –≥                           | –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –≥  | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–ö –ì—Ä–∞–Ω–¥ –ö–∞–Ω—å–æ–Ω           |          44332
 –°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª                             | –°–∞—Ä–∞—Ç–æ–≤ –≥          | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ "–¢–ê–£ –ì–∞–ª–µ—Ä–µ—è"          |          56277
 –°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª                            | –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –≥     | –ö–ê–†–û –§–ò–õ–¨–ú                | –ö–ê–†–û –§–ò–õ–¨–ú –†–∞–¥—É–≥–∞ –ü–∞—Ä–∫                   |          33769
 –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π                         | –°—Ç–∞–≤—Ä–æ–ø–æ–ª—å –≥       | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ "–ö–æS–º–æ—Å"               |          73472
 –¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª                              | –¢–∞–º–±–æ–≤ –≥           | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –¢–∞–º–±–æ–≤                       |          13517
 –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω –†–µ—Å–ø                              | –ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã –≥ | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –¢–æ—Ä–≥–æ–≤—ã–π –ö–≤–∞—Ä—Ç–∞–ª       |          34947
 –¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª                                | –¢–≤–µ—Ä—å –≥            | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –¢–≤–µ—Ä—å                        |          22120
 –¢—É–ª—å—Å–∫–∞—è –æ–±–ª                                | –¢—É–ª–∞ –≥             | –°–ò–ù–ï–ú–ê-–°–¢–ê–†               | –°–∏–Ω–µ–º–∞ –°—Ç–∞—Ä –¢—É–ª–∞                         |           9386
 –¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª                               | –¢—é–º–µ–Ω—å –≥           | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –ì—É–¥–≤–∏–Ω                 |          46881
 –£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø                             | –ò–∂–µ–≤—Å–∫ –≥           | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–∏–Ω–µ–º–∞ –ü–∞—Ä–∫ –≤ –¢–†–¶ –ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π             |          19871
 –£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª                             | –£–ª—å—è–Ω–æ–≤—Å–∫ –≥        | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –ê–∫–≤–∞ –ú–æ–ª–ª              |          29074
 –•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥ - –Æ–≥—Ä–∞ –ê–û | –°—É—Ä–≥—É—Ç –≥           | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –°–∏—Ç–∏ –ú–æ–ª–ª              |          24840
 –ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª                             | –ß–µ–ª—è–±–∏–Ω—Å–∫ –≥        | –°–ò–ù–ï–ú–ê –ü–ê–†–ö               | –°–ò–ù–ï–ú–ê –ü–ê–†–ö –≤ –¢–†–¶ –ì–æ—Ä–∫–∏                  |          27633
 –Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª                             | –Ø—Ä–æ—Å–ª–∞–≤–ª—å –≥        | –ê–û "–ö–∏–Ω–æ–º–∞–∫—Å" –≤ –≥. –ú–æ—Å–∫–≤–∞ | ¬´–ö–∏–Ω–æ–º–∞–∫—Å-–ê—É—Ä–∞¬ª –≥. –Ø—Ä–æ—Å–ª–∞–≤–ª—å             |          29731
(37 ÒÚÓÍ)

